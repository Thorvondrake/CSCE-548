<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Nocturne Archive | Management Portal</title>
    <style>
        body { font-family: 'Inter', sans-serif; background: #0f172a; color: #f8fafc; padding: 2rem; }
        .card { background: #1e293b; border-radius: 12px; padding: 2rem; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
        button { background: #3b82f6; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer; font-weight: 600; }
        button:hover { background: #2563eb; }
        input { background: #334155; border: 1px solid #475569; color: white; padding: 0.75rem; border-radius: 6px; }
        table { width: 100%; border-collapse: collapse; margin-top: 1.5rem; }
        th { text-align: left; color: #94a3b8; border-bottom: 2px solid #334155; padding: 0.75rem; font-size: 0.875rem; }
        td { padding: 0.75rem; border-bottom: 1px solid #334155; }
    </style>
</head>
<body>
    <div class="card">
        <h1>Nocturne Archive Portal</h1>
        <p>Project 3 Client Interface</p>
        
        <div class="grid">
            <button onclick="fetchData('inventory')">Get All Records</button>
            <button onclick="fetchData('signed')">Get Signed Subset</button>
            <div style="display: flex; gap: 0.5rem;">
                <input type="number" id="bookId" placeholder="ID">
                <button onclick="fetchSingle()">Get Single</button>
            </div>
        </div>

        <table id="archiveTable">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Title</th>
                    <th>Condition</th>
                    <th>Price</th>
                    <th>Signed</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>

    <script>
        const BASE_URL = "https://csce-548.onrender.com";

        async function apiCall(endpoint) {
            console.log("Attempting to reach endpoint: " + endpoint);
            try {
                const response = await fetch(`${BASE_URL}/${endpoint}`);
                console.log("Response status: ", response.status);
                
                const data = await response.json();
                console.log("Data received: ", data);
                
                renderTable(Array.isArray(data) ? data : [data]);
            } catch (error) {
                console.error("Critical Fetch Error: ", error);
            }
        }

        async function fetchData(endpoint) {
            const res = await fetch(`${BASE_URL}/${endpoint}`);
            const data = await res.json();
            render(data);
        }

        async function fetchSingle() {
            const id = document.getElementById('bookId').value;
            const res = await fetch(`${BASE_URL}/inventory/${id}`);
            const data = await res.json();
            render([data]); // Wrap in array for the renderer
        }

        function render(data) {
            const body = document.getElementById('tableBody');
            body.innerHTML = data.map(book => `
                <tr>
                    <td>${book.id}</td>
                    <td>${book.title}</td>
                    <td>${book.condition}</td>
                    <td>$${book.price.toFixed(2)}</td>
                    <td>${book.isSigned ? "Yes" : "No"}</td>
                </tr>
            `).join('');
        }
    </script>
</body>
</html>